# certificate files
$DefaultNetstreamDriverCAFile /usr/local/share/ca-certificates/web-root.crt
$DefaultNetstreamDriverCertFile /opt/tls/certificate.crt
$DefaultNetstreamDriverKeyFile /opt/tls/private.key

# use gtls netstream driver
$DefaultNetstreamDriver gtls

# require TLS for the connection
$ActionSendStreamDriverMode 1

# server is authenticated
$ActionSendStreamDriverAuthMode x509/name
$ActionSendStreamDriverPermittedPeer backup.imovies.ch

# include audit log generated by auditd
$ModLoad imfile
$InputFileName /var/log/audit/audit.log
$InputFileTag tag_audit_log:
$InputFileSeverity info
$InputFileFacility local6
$InputRunFileMonitor

# include logs generated by the backend
$InputFileName /home/webapp/out.log
$InputFileTag tag_ca_backend_log:
$InputFileSeverity info
$InputFileFacility local0
$InputRunFileMonitor

$InputFileName /home/webapp/error.log
$InputFileTag tag_ca_backend_error:
$InputFileSeverity err
$InputFileFacility local0
$InputRunFileMonitor

$InputFileName /home/webapp/audit.log
$InputFileTag tag_ca_backend_audit:
$InputFileSeverity info
$InputFileFacility local0
$InputRunFileMonitor

# send all logs to the backup server. two @@ => TCP
# NOTE: (o) is not a mistake, see https://rsyslog.readthedocs.io/en/latest/tutorials/tls.html
*.* @@(o)backup.imovies.ch:10514